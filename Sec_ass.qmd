---
title: "sec_ass"
format: html
editor: visual
bibliography: Datasetthoyde-inntekt.bib
nocite: '@*'
---

```{r}
#| label: setup
#| echo: false
#| output: false
#| message: false
library(vtable)
library(tidyverse)
library(ggplot2)
library(tinytex)
library(ggpubr)
```

```{r}
#| echo: false
hoyde <- modelr::heights
hoyde <- hoyde |>
  mutate(
    bmi = weight * 0.4536/(height * 2.54/100)^2,
    married = fct_collapse(
      .f = marital,
      married = "married",
      other_level = "not married"
      ),
    edu_fac = cut(
      x = education,
      breaks = c(0, 12, 14, 16, 21),
      labels = c("not_hs", "not_cc", "not_col", "col_plus"),
      right = FALSE
      )
    ) |>
  select(income:age, education:bmi, everything()) |>
  select(-education, -marital)
hoydeZeroInc <- hoyde |>
  filter(income == 0)
hoydeNormInc <- hoyde |>
  filter(income > 0 & income < 343830)
hoydeHighInc <- hoyde |>
  filter(income == 343830)
```

## Innledning

I denne oppgaven skal vi se på to ulike sammenhenger.
Sammenhengen mellom evnenivå og inntekt, og sammenhengen mellom ansiennitet og inntekt.

Vi bruker datasettet heights og deler datasettet opp i tre ulike fordelt på inntektsnivået.
Det første settet er for de med ingen inntekt.
Det andre settet er for normal inntekt der selve inntekten er mellom 0 og 343 830 amerikanske dollar.
Det siste settet er for de 2% høyeste inntektene.
Gjennomsnittlig inntekt for disse øvre 2% er 343 830 amerikanske dollar.

Når vi sammeligner evnenivå og inntekt, bruker vi variabelen afqt.
Dette er en måleenhet som det amerikanske militæret bruker til å måle evnenivå.
@zotero-254

## Litteraturgjennomgang

Tidligere forskning viser at det er en sammenheng mellom inntekt og evnenivå.
Det er påvis at for hvert ekstra IQ poeng, kan inntekten øke fra \$234 til \$616 per år @zagorsky2007.
Tidligere forskning med søsken viser at forholdet mellom inntekt og evnenivå er sterkere mellom søstre sammenlignet med brødre @bound1986.

## Sammenheng mellom inntekt og evnenivå

```{r}
#| message: false
#| warning: false
#| label: fig-afqt-inc
#| fig-cap: "Sammenhengen mellom afqt og inntekt."
#sammenheng mellom afqt og inntekt i hoydeNormInc
hoydeNormInc |>
  # filtrerer bort obs.der vi ikke har afqt
  filter(!is.na(afqt)) |> 
  ggplot(mapping = aes(x = afqt, y = income)) +
  geom_point() +
  geom_smooth()

```

I @fig-afqt-inc ser vi en sammenheng mellom evnenivå og inntekt i datasettet hoydeNormInc.
Vi ser en stigning i den lineære linjen, noe som tilsier at økt evnenivå gir høyere inntekt.

```{r}
#| warning: false
#| label: fig-afqt-incLevel
#| fig-cap: "Tetthetsfunksjoner for evnenivå for de tre inntekstgruppene, ZeroInc (blå), NormInc (green) og HighInc (red)."
# afqt i hoydeZeroInc og hoydeHighInc
ggplot() +
  geom_density(
    data = hoydeZeroInc,
    mapping = aes(x = afqt),
    alpha = 0.3,
    colour = "blue",
    fill = "blue"
    ) +
  geom_density(
    data = hoydeHighInc,
    mapping = aes(x = afqt),
    alpha = 0.3,
    colour = "red",
    fill = "red"
  ) +
  geom_density(
    data = hoydeNormInc,
    mapping = aes(x = afqt),
    alpha = 0.3,
    colour = "green",
    fill = "green"
  )
```

I @fig-afqt-incLevel ser vi på sammenhengen mellom evnenivået i to ulike datasett.
Datasettene som er brukt er hoydeZeroInc og hoydeHighInc.
Her ser vi at det er en klar differane i evnenivået i de ulike datasettene.
Datasettet med høy inntekt har helt klart høyere grad av envenivå sammenlignet med datasettet med ingen inntekt.

```{r}
#| warning: false
#| message: false
#sammenheng mellom afqt og inntekt, facet mht. kjønn
#my_hoyde <- data.frame(afqt = hoyde$afqt,income = hoyde$income, sex = hoyde$sex)
#
# Jeg vil anbefale å heller benytte hoydeNormInc

hoydeNormInc |> 
  filter(!is.na(afqt)) |> 
  ggplot(mapping = aes(x = afqt, y = income)) +
  geom_point() +
  geom_smooth(method = lm, se = FALSE) +
  facet_wrap(~ sex)
```

Her ser vi at evnenivå gir et sterkere utslag på inntekt hos mennene enn hos kvinnene.

```{r}
#| warning: false
#| message: false
#sammenheng mellom edu_fac/education og afqt
hoyde |>
  # Dropper NA obs.
  filter(!is.na(edu_fac)) |> 
  ggplot(
    mapping = aes(
    # Bytter om på variablene her
    # høyere evnenivå afqt (IQ) => mer utdanning 
    # ikke: mer utdanning => høyere evnenivå afqt (IQ) dessverre ;-)
    x = afqt,
    y = edu_fac
  )
) +
# Add a box plot  
geom_boxplot()  
```

Her ser vi en klar sammenheng mellom utdanningsnivå og evnenivå.
Vi ser at for hvert utdanningsnivå så øker medianen til evnenivået.
Det som befinner deg innenfor boksene, er de midterste 50 % av verdiene.
Vi kan se her at det er større spredning på evnenivået på de med høyere utdanning sammenlignet med de som ikke har utdannelse.

```{r}
#| warning: false
#| message: false
#sammenheng mellom høyde og afqt
hoyde |>
  select(afqt, height) |>
  ggplot(mapping = aes(x = afqt, y = height)) +
  geom_point() +
  geom_smooth(method = lm)
```

I dette plottet har vi sammenlighet evnenivå og høyde.
Vi kan se her at liten stigning i den linjære linjen.
Dette kan muligens forklares ved hjelp av det neste histogrammet.
I histogrammet sammenligner vi evnenivå på kvinner og menn.
Her ser vi at det er flest menn på høyt evnenivå.
Menn er også gjennomsnittlig høyere enn kvinner.

```{r}
#| warning: false
# sammenligner afqt kvinner og menn på hele datasettet (ekstra) 
hoyde |>
  ggplot() +
  geom_histogram(
    data = filter(hoyde, sex == "male"),
    mapping = aes(x = afqt, y = after_stat(density)),
    alpha = 0.3,
    colour = "blue",
    fill = "blue"
  ) + 
  geom_histogram(
    data = filter(hoyde, sex == "female"),
    mapping = aes(x = afqt, y = after_stat(density)),
    alpha = 0.5,
    colour = "red",
    fill = "red"
  )

```

```{r}
hoyde |>
  filter(!is.na(afqt)) %>% 
  ggplot() +
  geom_density(
    mapping = aes(x = afqt, fill = sex, colour = sex),
    alpha = 0.3
  )
```

## Sammenheng mellom ansiennitet og inntekt

Vi lager en scatter-plot med regresjonslinje for å undersøke om det er sammenheng mellom ansennitet og inntekt.

```{r}
hoyde |> 
  ggplot(
  mapping = aes(
    x = age,
    y = income
    )
  ) + 
      geom_jitter(
    size = 0.5,
    alpha = 0.40
    ) +
  geom_smooth(
    formula = y ~ x,
    method = "lm",
    colour = "black",
    lwd = 1,
    se = FALSE
    )
```

Det virker som at regresjonslinjen er horisontal, det vil si at det ikke virker å være sammenheng mellom ansennitet og alder.
Dette virker snodig, men vi må ha i bakhodet at datasettet vi arbeider med har aldersgruppene 48-56, noe som kan tilsi at de allerede er på toppen av sin ansennitet

Vi undersøker deretter om det er sammenheng mellom ansennitet og alder på de forskjellige kjønn:

```{r}
#| message: false
hoydeNormInc %>%
  ggplot(aes(x = age, y = income, color = sex)) +
  geom_point(
    size = 2,
    alpha = 0.5
  ) +
  geom_smooth(
    aes(group = sex),
    method = "lm",
    se = FALSE
  ) +
  labs(
    x = "Age",
    y = "Income",
    color = "Sex"
    )
```

Regresjonslinjene viser igjen at mer ansennitet ikke nødvendigvis gir høyere lønn, selv fordelt på kjønn.

Vi lager et histogram av dataene fordelt på undergrupper.

Vi starter med å regne ut gjennomsnittlig ansennitet og standardavvik for hhv.
menn og kvinner.
Disse parametrene vil vi bruke for å tegne inn normalfordelingskurver i samme plot.

```{r}
meanAgeMale <- hoyde |> 
  filter(sex == 'male') %>% 
  select(age) |> 
  pull() |> 
  mean()

meanAgeFemale <- hoyde |> 
  filter(sex == 'female') %>% 
  select(age) |> 
  pull() |> 
  mean()

# standard deviation
sdAgeMale <- hoyde |> 
  filter(sex == 'male') |> 
  select(age) |> 
  pull() |> 
  sd()

sdAgeFemale <- hoyde |>
  filter(sex == 'female') |>
  select(age) |>
  pull() |> 
  sd()
```

```{r}
hoyde %>%
  ggplot() +
  ### male ###
  geom_histogram(
    data = filter(hoyde, sex == "male"),
    mapping = aes(x = age, y = after_stat(density)),
    binwidth = 1, alpha = 0.3, colour = 'blue', fill = 'blue'
    ) + 
  geom_vline(
    xintercept = meanAgeMale,
    colour = 'grey40', lwd = 0.75, linetype = 3
    ) +
  stat_function(
    fun = dnorm,
    args = list(mean = meanAgeMale, sd = sdAgeMale),
    colour = 'grey40'
    ) +
  # female
  geom_histogram(
    data = filter(hoyde, sex == "female"),
    mapping = aes(x = age, y = after_stat(density)),
    binwidth = 1, alpha = 0.7, colour = 'pink', fill = 'pink'
    ) +
  stat_function(
    fun = dnorm, args = list(mean = meanAgeFemale, sd = sdAgeFemale),
    colour = 'pink'
    ) +
  geom_vline(
    xintercept = meanAgeFemale, colour = 'pink', lwd = 0.75, linetype = 3
    )
```

Histogrammene viser at i dette datasettet er det mer kvinner enn menn i aldersgruppen 53-56 år.
Da kvinner har lavere inntekt enn menn kan dette forklare resultatet i sammenhengen mellom ansennitet og alder.
Jo lengre ansennitet en har, jo høyere er kvinneandelen, med medførende lavere inntekt, som kan forklare at lengre ansennitet ikke fører til høyere lønn.
Det er ikke lønna som går ned, det er at menn med høyere inntekt forsvinner.

En litt enklere variant:

```{r}
hoydeNormInc |>
  ggplot() +
  geom_density(mapping = aes(x = age, fill = sex, colour = sex), 
               alpha = 0.3
               )
```

Vi undersøker om det er markante kjønnsforskjeller mht.
alder i hoydeZeroInc, hoydeHighInc og HoydeNormInc.

```{r}
hoyde |>
  ggplot() +
  geom_histogram(
    data = filter(hoydeNormInc, sex == "male"),
    mapping = aes(x = age, y = after_stat(density)),
    alpha = 0.3,
    colour = "blue",
    fill = "blue"
  ) + 
  geom_histogram(
    data = filter(hoydeNormInc, sex == "female"),
    mapping = aes(x = age, y = after_stat(density)),
    alpha = 0.5,
    colour = "red",
    fill = "red"
  )
hoydeNormInc |>
  ggplot(
  mapping = aes(
    x = age,
    y = income
    )
  ) +
  geom_smooth(
    formula = y ~ x,
    method = "lm",
    colour = "black",
    lwd = 0.75,
    se = FALSE
    )
```

```{r}
hoyde |>
  ggplot() +
  geom_histogram(
    data = filter(hoydeZeroInc, sex == "male"),
    mapping = aes(x = age, y = after_stat(density)),
    alpha = 0.3,
    colour = "blue",
    fill = "blue"
  ) + 
  geom_histogram(
    data = filter(hoydeZeroInc, sex == "female"),
    mapping = aes(x = age, y = after_stat(density)),
    alpha = 0.5,
    colour = "red",
    fill = "red"
  )
hoydeZeroInc |>
  ggplot(
  mapping = aes(
    x = age,
    y = income
    )
  ) +
  geom_smooth(
    formula = y ~ x,
    method = "lm",
    colour = "black",
    lwd = 0.75,
    se = FALSE
    )
```

```{r}
hoyde |>
  ggplot() +
  geom_histogram(
    data = filter(hoydeHighInc, sex == "male"),
    mapping = aes(x = age, y = after_stat(density)),
    alpha = 0.3,
    colour = "blue",
    fill = "blue"
  ) + 
  geom_histogram(
    data = filter(hoydeHighInc, sex == "female"),
    mapping = aes(x = age, y = after_stat(density)),
    alpha = 0.5,
    colour = "red",
    fill = "red"
  )
hoydeHighInc |>
  ggplot(
  mapping = aes(
    x = age,
    y = income
    )
  ) +
  geom_smooth(
    formula = y ~ x,
    method = "lm",
    colour = "black",
    lwd = 0.75,
    se = FALSE
    )
```

Histogrammet viser at i gruppen høy inntekt har aldersgrupper hvor det ikke forekommer kvinner, dette vil som tidligere nevnt gjøre at det ser ut som at jo høyere ansennitet ikke påvirker lønn.

«Vi undersøker om det er markante kjønnsforskjeller mht.
alder i hoydeZeroInc, hoydeHighInc og HoydeNormInc.» For å undersøke dette tror jeg tabeller er bedre

```{r}
hoydeZeroInc |> 
  mutate(alder = as_factor(age)) |> 
  select(alder) |> 
  st()
```

```{r}
hoydeNormInc |> 
  mutate(alder = as_factor(age)) |> 
  select(alder) |> 
  st()
```

```{r}
hoydeHighInc |> 
  mutate(alder = as_factor(age)) |> 
  select(alder) |> 
  st()
```

## Konklusjon

Vi ser en klar sammenheng mellom evnenivå og inntekt.
Som vi så i box-plottet kan dette skyldes at de med høyest utdannelse har høyere evnenivå sammenlignet med de som ikke har utdannelse.
En logisk konklusjon er at de me høyere utdannelse får seg jobber som gir høyere lønn.

## Referanser
